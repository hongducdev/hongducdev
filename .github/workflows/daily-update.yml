name: Daily Auto Update

on:
    schedule:
        - cron: "0 0 * * *" # Cháº¡y hÃ ng ngÃ y lÃºc 00:00 UTC (7:00 sÃ¡ng giá» Viá»‡t Nam)
    workflow_dispatch: # Cho phÃ©p cháº¡y thá»§ cÃ´ng

jobs:
    daily-update:
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“¥ Checkout repository
              uses: actions/checkout@v4
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: ğŸ“… Set current date
              id: date
              run: echo "date=$(date '+%Y-%m-%d')" >> $GITHUB_OUTPUT

            - name: ğŸ“ Update timestamp
              run: |
                  echo "# Last Updated" > .last-updated
                  echo "" >> .last-updated
                  echo "- Date: $(date '+%Y-%m-%d')" >> .last-updated
                  echo "- Time: $(date '+%H:%M:%S UTC')" >> .last-updated
                  echo "- Timestamp: $(date '+%s')" >> .last-updated

            - name: ğŸ“Š Generate stats
              run: |
                  echo "" >> .last-updated
                  echo "## Repository Stats" >> .last-updated
                  echo "- Total HTML files: $(find . -name '*.html' -not -path './node_modules/*' | wc -l)" >> .last-updated
                  echo "- Total JS files: $(find . -name '*.js' -not -path './node_modules/*' | wc -l)" >> .last-updated
                  echo "- Total CSS files: $(find . -name '*.css' -not -path './node_modules/*' | wc -l)" >> .last-updated

            - name: ğŸ¤– Auto commit daily update
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                  commit_message: "ğŸ“… Daily auto update: ${{ steps.date.outputs.date }}"
                  branch: main
                  commit_user_name: Daily Bot
                  commit_user_email: daily-bot@github-actions.com
                  file_pattern: ".last-updated"
                  skip_dirty_check: false
